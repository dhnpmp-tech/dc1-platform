<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DC1 Provider Registration</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            background: #111111;
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.1);
        }
        
        h1 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #00D9FF;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #FFD700;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #333333;
            border-radius: 5px;
            background: #222222;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #00D9FF;
            background: #1a1a1a;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-submit {
            background: #FFD700;
            color: #000000;
        }
        
        .btn-submit:hover:not(:disabled) {
            background: #FFC700;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }
        
        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status {
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }
        
        .status.show {
            display: block;
        }
        
        .status.success {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid #00D9FF;
            color: #00D9FF;
        }
        
        .status.error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff4444;
            color: #ff4444;
        }
        
        .status.loading {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #FFD700;
            color: #FFD700;
            text-align: center;
        }
        
        .status h3 {
            margin-bottom: 10px;
        }
        
        .status p {
            margin: 8px 0;
            font-size: 14px;
        }
        
        .status code {
            display: block;
            background: #000000;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .copy-btn {
            padding: 8px 12px;
            background: #00D9FF;
            color: #000000;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .download-link {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 20px;
            background: #FFD700;
            color: #000000;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .download-link:hover {
            background: #FFC700;
            transform: translateY(-2px);
        }
        
        .gpu-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .gpu-option {
            padding: 12px;
            border: 1px solid #333333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .gpu-option:hover {
            border-color: #00D9FF;
            background: rgba(0, 217, 255, 0.1);
        }
        
        .gpu-option.selected {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }
        
        .info-box {
            background: rgba(0, 217, 255, 0.1);
            border-left: 3px solid #00D9FF;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 3px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Become a DC1 Provider</h1>
        <p class="subtitle">Earn Ô∑º by sharing your GPU compute power</p>
        
        <div class="info-box">
            üí° <strong>Quick setup:</strong> Takes 5 minutes. No coding required. Automatic earnings every hour.
        </div>

        <!-- GPU Autodetect Banner -->
        <div id="gpu-detect-banner" style="display:none; background:rgba(255,215,0,0.08); border:1px solid #FFD700; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div style="display:flex;align-items:center;gap:10px;">
                <span style="font-size:24px;">üîç</span>
                <div style="flex:1;">
                    <strong style="color:#FFD700;" id="detect-title">Detecting your GPU...</strong>
                    <p style="color:#999;font-size:12px;margin-top:4px;" id="detect-subtitle">Scanning via WebGL renderer</p>
                </div>
                <div id="detect-spinner" style="width:20px;height:20px;border:2px solid #333;border-top-color:#FFD700;border-radius:50%;animation:spin 0.8s linear infinite;"></div>
            </div>
        </div>
        <style>@keyframes spin{to{transform:rotate(360deg)}}</style>

        <form id="providerForm">
            <div class="form-group">
                <label>Your Full Name</label>
                <input type="text" id="name" placeholder="e.g., Fadi Al-Muhairi" required>
            </div>
            
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="email" placeholder="e.g., fadi@example.com" required>
            </div>
            
            <div class="form-group">
                <label>Your GPU Model <span id="gpu-detected-badge" style="display:none;background:#FFD700;color:#000;padding:2px 8px;border-radius:10px;font-size:11px;margin-left:8px;">AUTO-DETECTED</span></label>
                <div class="gpu-list" id="gpu-list">
                    <!-- NVIDIA Consumer -->
                    <div class="gpu-option" data-gpu="RTX 5090" data-vram="32" data-rate="1.80">
                        <strong>RTX 5090</strong><br><small>32GB ‚Ä¢ Ô∑º1.80/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 5080" data-vram="16" data-rate="1.20">
                        <strong>RTX 5080</strong><br><small>16GB ‚Ä¢ Ô∑º1.20/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 4090" data-vram="24" data-rate="1.00">
                        <strong>RTX 4090</strong><br><small>24GB ‚Ä¢ Ô∑º1.00/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 4080" data-vram="16" data-rate="0.80">
                        <strong>RTX 4080</strong><br><small>16GB ‚Ä¢ Ô∑º0.80/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 4070 Ti" data-vram="12" data-rate="0.60">
                        <strong>RTX 4070 Ti</strong><br><small>12GB ‚Ä¢ Ô∑º0.60/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 3090" data-vram="24" data-rate="0.75">
                        <strong>RTX 3090</strong><br><small>24GB ‚Ä¢ Ô∑º0.75/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 3080" data-vram="10" data-rate="0.55">
                        <strong>RTX 3080</strong><br><small>10GB ‚Ä¢ Ô∑º0.55/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="RTX 3060 Ti" data-vram="8" data-rate="0.40">
                        <strong>RTX 3060 Ti</strong><br><small>8GB ‚Ä¢ Ô∑º0.40/hr</small>
                    </div>
                    <!-- NVIDIA Data Center -->
                    <div class="gpu-option" data-gpu="H100" data-vram="80" data-rate="3.50">
                        <strong>H100</strong><br><small>80GB ‚Ä¢ Ô∑º3.50/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="A100" data-vram="40" data-rate="2.00">
                        <strong>A100</strong><br><small>40/80GB ‚Ä¢ Ô∑º2.00/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="L40S" data-vram="48" data-rate="1.60">
                        <strong>L40S</strong><br><small>48GB ‚Ä¢ Ô∑º1.60/hr</small>
                    </div>
                    <!-- AMD -->
                    <div class="gpu-option" data-gpu="RX 7900 XTX" data-vram="24" data-rate="0.70">
                        <strong>RX 7900 XTX</strong><br><small>24GB ‚Ä¢ Ô∑º0.70/hr</small>
                    </div>
                    <div class="gpu-option" data-gpu="MI300X" data-vram="192" data-rate="4.00">
                        <strong>MI300X</strong><br><small>192GB ‚Ä¢ Ô∑º4.00/hr</small>
                    </div>
                    <!-- Other -->
                    <div class="gpu-option" data-gpu="other" id="gpu-other-option" style="border-style:dashed;">
                        <strong>Other GPU</strong><br><small>Enter manually</small>
                    </div>
                </div>
                <input type="hidden" id="gpu_model" required>
                <div id="gpu-custom-input" style="display:none;margin-top:10px;">
                    <input type="text" id="gpu_custom" placeholder="e.g., RTX 4060, Tesla V100, Apple M3 Ultra..." style="border-color:#FFD700;">
                </div>
            </div>
            
            <div class="form-group">
                <label>Your Operating System</label>
                <select id="os" required>
                    <option value="">Select your OS...</option>
                    <option value="Windows">Windows (10/11)</option>
                    <option value="Mac">macOS (Intel/Apple Silicon)</option>
                    <option value="Linux">Linux (Ubuntu/Debian)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Phone (Optional)</label>
                <input type="tel" id="phone" placeholder="e.g., +966 55 123 4567">
            </div>
            
            <div class="button-group">
                <button type="submit" class="btn-submit" id="submitBtn">
                    Register & Download Installer
                </button>
            </div>
        </form>
        
        <div id="status"></div>
    </div>
    
    <script>
        // =====================================================================
        // GPU AUTODETECT via WebGL
        // =====================================================================
        const GPU_KEYWORDS = {
            'RTX 5090': ['5090'],
            'RTX 5080': ['5080'],
            'RTX 4090': ['4090'],
            'RTX 4080': ['4080'],
            'RTX 4070 Ti': ['4070 ti', '4070ti'],
            'RTX 3090': ['3090'],
            'RTX 3080': ['3080'],
            'RTX 3060 Ti': ['3060 ti', '3060ti'],
            'H100': ['h100'],
            'A100': ['a100'],
            'L40S': ['l40s', 'l40'],
            'RX 7900 XTX': ['7900 xtx', '7900xtx'],
            'MI300X': ['mi300x', 'mi300'],
        };

        function detectGPU() {
            const banner = document.getElementById('gpu-detect-banner');
            banner.style.display = 'block';

            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl2') || canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) throw new Error('WebGL not supported');

                const ext = gl.getExtension('WEBGL_debug_renderer_info');
                let renderer = ext ? gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
                let vendor = ext ? gl.getParameter(ext.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);

                if (!renderer || renderer === 'WebKit WebGL' || renderer.includes('SwiftShader') || renderer.includes('llvmpipe')) {
                    throw new Error('Generic/software renderer detected');
                }

                // Try to match to a known GPU
                const rendererLower = renderer.toLowerCase();
                let matchedGPU = null;

                for (const [gpuName, keywords] of Object.entries(GPU_KEYWORDS)) {
                    if (keywords.some(kw => rendererLower.includes(kw))) {
                        matchedGPU = gpuName;
                        break;
                    }
                }

                if (matchedGPU) {
                    // Auto-select the matched GPU card
                    const option = document.querySelector(`.gpu-option[data-gpu="${matchedGPU}"]`);
                    if (option) {
                        document.querySelectorAll('.gpu-option').forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        option.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        document.getElementById('gpu_model').value = matchedGPU;
                    }

                    document.getElementById('detect-title').textContent = `Detected: ${matchedGPU}`;
                    document.getElementById('detect-subtitle').textContent = `Renderer: ${renderer} (${vendor})`;
                    document.getElementById('detect-spinner').style.display = 'none';
                    document.getElementById('gpu-detected-badge').style.display = 'inline';
                    banner.style.borderColor = '#4ade80';
                    banner.style.background = 'rgba(74,222,128,0.08)';
                    document.getElementById('detect-title').style.color = '#4ade80';
                } else {
                    // Detected a GPU but can't match it to our list
                    document.getElementById('detect-title').textContent = `GPU Found: ${renderer}`;
                    document.getElementById('detect-subtitle').textContent = `Not in our catalog yet ‚Äî please select the closest match or choose "Other GPU"`;
                    document.getElementById('detect-spinner').style.display = 'none';
                    banner.style.borderColor = '#00D9FF';
                }
            } catch (e) {
                document.getElementById('detect-title').textContent = 'Could not auto-detect GPU';
                document.getElementById('detect-subtitle').textContent = 'Please select your GPU manually below';
                document.getElementById('detect-spinner').style.display = 'none';
                banner.style.borderColor = '#666';
                banner.style.background = 'rgba(100,100,100,0.08)';
                document.getElementById('detect-title').style.color = '#999';
            }
        }

        // =====================================================================
        // OS AUTODETECT
        // =====================================================================
        function detectOS() {
            const ua = navigator.userAgent.toLowerCase();
            const osSelect = document.getElementById('os');
            if (ua.includes('win')) osSelect.value = 'Windows';
            else if (ua.includes('mac')) osSelect.value = 'Mac';
            else if (ua.includes('linux') || ua.includes('ubuntu') || ua.includes('debian')) osSelect.value = 'Linux';
        }

        // Run autodetect on page load
        detectGPU();
        detectOS();

        // =====================================================================
        // GPU Selection handlers
        // =====================================================================
        document.querySelectorAll('.gpu-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.gpu-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');

                const customInput = document.getElementById('gpu-custom-input');
                if (this.dataset.gpu === 'other') {
                    customInput.style.display = 'block';
                    document.getElementById('gpu_custom').focus();
                    document.getElementById('gpu_model').value = '';
                } else {
                    customInput.style.display = 'none';
                    document.getElementById('gpu_model').value = this.dataset.gpu;
                }
            });
        });

        // Sync custom GPU input to hidden field
        document.getElementById('gpu_custom').addEventListener('input', function() {
            document.getElementById('gpu_model').value = this.value;
        });
        
        document.getElementById('providerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const statusDiv = document.getElementById('status');
            const submitBtn = document.getElementById('submitBtn');
            
            if (!document.getElementById('gpu_model').value) {
                showStatus(statusDiv, 'error', 'Please select a GPU model');
                return;
            }
            
            submitBtn.disabled = true;
            showStatus(statusDiv, 'loading', 'Processing your registration...');
            
            try {
                const data = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    gpu_model: document.getElementById('gpu_model').value,
                    os: document.getElementById('os').value,
                    phone: document.getElementById('phone').value || null
                };
                
                const response = await fetch('/api/providers/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error('Registration failed');
                
                const result = await response.json();
                const apiKey = result.api_key;
                
                const successHTML = `
            <h3>\u2705 Registration Successful!</h3>
            <p><strong>Welcome to DC1, ${data.name}!</strong></p>
            <div style="background:#1a1a2e;border:2px solid #FFD700;border-radius:8px;padding:16px;margin:16px 0;">
              <p style="margin:0 0 8px;color:#ccc;">Your API Key (save this!):</p>
              <div style="display:flex;align-items:center;gap:8px;">
                <code style="color:#FFD700;font-size:1.1em;word-break:break-all;flex:1;">${apiKey}</code>
                <button type="button" class="copy-btn" onclick="copyToClipboard('${apiKey}')" style="white-space:nowrap;">
                  \ud83d\udccb Copy Key
                </button>
              </div>
            </div>

            <h4 style="margin-top:24px;color:#00D9FF;">Step 1: Download Installer</h4>
            <div style="display:flex;flex-wrap:wrap;gap:10px;margin:12px 0;">
              <a href="/installers/dc1-provider-setup-Windows.exe" class="download-link" style="flex:1;min-width:140px;text-align:center;" download>
                \ud83d\udda5\ufe0f Windows .exe
              </a>
              <a href="/installers/dc1-provider-setup-Linux.deb" class="download-link" style="flex:1;min-width:140px;text-align:center;" download>
                \ud83d\udc27 Linux .deb
              </a>
              <a href="/installers/dc1-provider-setup.sh" class="download-link" style="flex:1;min-width:140px;text-align:center;" download>
                \ud83d\udce6 macOS / Linux .sh
              </a>
            </div>

            <h4 style="margin-top:24px;color:#00D9FF;">Step 2: Run the Installer</h4>

            <div style="background:#0d1117;border:1px solid #333;border-radius:8px;padding:16px;margin:12px 0;">
              <p style="color:#00D9FF;margin:0 0 8px;font-weight:bold;">\ud83d\udda5\ufe0f Windows:</p>
              <p style="color:#ccc;margin:0;">Double-click <code>dc1-provider-setup-Windows.exe</code> and follow the prompts.</p>
            </div>

            <div style="background:#0d1117;border:1px solid #333;border-radius:8px;padding:16px;margin:12px 0;">
              <p style="color:#00D9FF;margin:0 0 8px;font-weight:bold;">\ud83d\udc27 Linux (.deb):</p>
              <code style="color:#8be9fd;display:block;margin:4px 0;">sudo dpkg -i dc1-provider-setup-Linux.deb</code>
              <code style="color:#8be9fd;display:block;margin:4px 0;">dc1-provider-setup ${apiKey}</code>
              <button type="button" class="copy-btn" onclick="copyToClipboard('sudo dpkg -i dc1-provider-setup-Linux.deb && dc1-provider-setup ${apiKey}')" style="margin-top:8px;">
                \ud83d\udccb Copy Commands
              </button>
            </div>

            <div style="background:#0d1117;border:1px solid #333;border-radius:8px;padding:16px;margin:12px 0;">
              <p style="color:#00D9FF;margin:0 0 8px;font-weight:bold;">\ud83c\udf4e macOS / Linux (.sh):</p>
              <p style="color:#888;margin:0 0 8px;font-size:0.9em;">Open Terminal and run:</p>
              <code style="color:#8be9fd;display:block;margin:4px 0;">chmod +x ~/Downloads/dc1-provider-setup.sh</code>
              <code style="color:#8be9fd;display:block;margin:4px 0;">bash ~/Downloads/dc1-provider-setup.sh ${apiKey}</code>
              <button type="button" class="copy-btn" onclick="copyToClipboard('chmod +x ~/Downloads/dc1-provider-setup.sh && bash ~/Downloads/dc1-provider-setup.sh ${apiKey}')" style="margin-top:8px;">
                \ud83d\udccb Copy Commands
              </button>
            </div>

            <div style="background:#1a1a2e;border:1px solid #444;border-radius:8px;padding:12px;margin-top:16px;">
              <p style="color:#ccc;margin:0;font-size:0.9em;">\ud83d\udca1 <strong>What happens next?</strong> The installer sets up Docker and starts the DC1 provider daemon. Your GPU will begin accepting jobs and earning \ufdfc automatically. Check your status anytime at <a href="/api/providers/status/${apiKey}" style="color:#00D9FF;">/api/providers/status/${apiKey}</a></p>
            </div>
          `;
                
                showStatus(statusDiv, 'success', successHTML);
                
            } catch (error) {
                showStatus(statusDiv, 'error', `Registration failed: ${error.message}`);
                submitBtn.disabled = false;
            }
        });
        
        function showStatus(div, type, content) {
            div.className = `status show ${type}`;
            div.innerHTML = content;
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }
    </script>
</body>
</html>

